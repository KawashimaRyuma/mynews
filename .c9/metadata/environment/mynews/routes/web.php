{"filter":false,"title":"web.php","tooltip":"/mynews/routes/web.php","undoManager":{"mark":32,"position":32,"stack":[[{"start":{"row":27,"column":0},"end":{"row":27,"column":76},"action":"remove","lines":["　　Route::get('news/edit', 'Admin\\NewsController@edit')->middleware('auth'); "],"id":2}],[{"start":{"row":27,"column":0},"end":{"row":27,"column":1},"action":"insert","lines":[" "],"id":3},{"start":{"row":27,"column":1},"end":{"row":27,"column":2},"action":"insert","lines":[" "]},{"start":{"row":27,"column":2},"end":{"row":27,"column":3},"action":"insert","lines":[" "]},{"start":{"row":27,"column":3},"end":{"row":27,"column":4},"action":"insert","lines":[" "]},{"start":{"row":27,"column":4},"end":{"row":27,"column":5},"action":"insert","lines":[" "]}],[{"start":{"row":27,"column":4},"end":{"row":27,"column":5},"action":"remove","lines":[" "],"id":4}],[{"start":{"row":27,"column":4},"end":{"row":27,"column":78},"action":"insert","lines":[" Route::get('news/edit', 'Admin\\NewsController@edit')->middleware('auth');"],"id":5}],[{"start":{"row":22,"column":0},"end":{"row":31,"column":0},"action":"remove","lines":["","Route::group(['prefix' => 'admin'], function() {","    Route::get('news/create', 'Admin\\NewsController@add')->middleware('auth');","    Route::post('news/create', 'Admin\\NewsController@create')->middleware('auth');","    Route::get('news', 'Admin\\NewsController@index')->middleware('auth'); ","     Route::get('news/edit', 'Admin\\NewsController@edit')->middleware('auth');","    Route::post('news/edit', 'Admin\\NewsController@update')->middleware('auth'); ","","});",""],"id":6}],[{"start":{"row":22,"column":0},"end":{"row":213,"column":0},"action":"insert","lines":["Route::group(['prefix' => 'admin'], function() {","    Route::get('news/create', 'Admin\\NewsController@add')->middleware('auth');","    Route::post('news/create', 'Admin\\NewsController@create')->middleware('auth');","    Route::get('news', 'Admin\\NewsController@index')->middleware('auth');","    Route::get('news/edit', 'Admin\\NewsController@edit')->middleware('auth'); // 追記","    Route::post('news/edit', 'Admin\\NewsController@update')->middleware('auth'); // 追記","","});","編集画面に実際にブラウザでアクセスしてみましょう。","","一覧画面にある表の一番右側に、編集リンクがあります。このリンクから編集画面に遷移し、実際にデータが編集できるか試してみましょう。","","","","データの削除","データの削除は、データの更新と同じくModelを取り出してから削除を指示します。","","Controller を実装する","NewsControllerに delete Actionを追加してください。","","<?php","","namespace App\\Http\\Controllers\\Admin;","","use Illuminate\\Http\\Request;","use App\\Http\\Controllers\\Controller;","","use App\\News;","","","class NewsController extends Controller","{","  public function add()","  {","      return view('admin.news.create');","  }","","  public function create(Request $request)","  {","","      // Varidationを行う","      $this->validate($request, News::$rules);","","      $news = new News;","      $form = $request->all();","","      // formに画像があれば、保存する","      if (isset($form['image'])) {","        $path = $request->file('image')->store('public/image');","        $news->image_path = basename($path);","      } else {","          $news->image_path = null;","      }","","      unset($form['_token']);","      unset($form['image']);","      // データベースに保存する","      $news->fill($form);","      $news->save();","","      return redirect('admin/news/create');","  }","","  public function index(Request $request)","  {","      $cond_title = $request->cond_title;","      if ($cond_title != '') {","          $posts = News::where('title', $cond_title)->get();","      } else {","          $posts = News::all();","      }","      return view('admin.news.index', ['posts' => $posts, 'cond_title' => $cond_title]);","  }","","","  public function edit(Request $request)","  {","      // News Modelからデータを取得する","      $news = News::find($request->id);","","      return view('admin.news.edit', ['news_form' => $news]);","  }","","","  public function update(Request $request)","  {","      // Validationをかける","      $this->validate($request, News::$rules);","      // News Modelからデータを取得する","      $news = News::find($request->id);","      // 送信されてきたフォームデータを格納する","      $news_form = $request->all();","      unset($news_form['_token']);","","      // 該当するデータを上書きして保存する","      $news->fill($news_form)->save();","","      return redirect('admin/news/');","  }","","  // 以下を追記　　","  public function delete(Request $request)","  {","      // 該当するNews Modelを取得","      $news = News::find($request->id);","      // 削除する","      $news->delete();","      return redirect('admin/news/');","  }  ","","","}","次はデータの削除について考えていきます。","","一般的に削除に対応するAction名はdeleteになります。","","public function delete(Request $request)","  {","      // 該当するNews Modelを取得","      $news = News::find($request->id);","      // 削除する","      $news->delete();","      return redirect('admin/news/');","  }","データをセーブするときは、$news->save();でsaveメソッドを利用しましたが、データの場合はdelete()メソッドを使います。","","また、 resources/views/admin/news/index.blade.php を削除リンクを表示するように修正します。","","                        <tbody>","                            @foreach($posts as $news)","                                <tr>","                                    <th>{{ $news->id }}</th>","                                    <td>{{ str_limit($news->title, 100) }}</td>","                                    <td>{{ str_limit($news->body, 250) }}</td>","                                    <td>","                                        <div>","                                            <a href=\"{{ action('Admin\\NewsController@edit', ['id' => $news->id]) }}\">編集</a>","                                        </div>","                                        <div>","                                            <a href=\"{{ action('Admin\\NewsController@delete', ['id' => $news->id]) }}\">削除</a>","                                        </div>","                                    </td>","                                </tr>","                            @endforeach","                        </tbody>","Routingを実装する","routes/web.php に追加するRouting設定です。","","Route::group(['prefix' => 'admin'], function() {","    Route::get('news/create', 'Admin\\NewsController@add')->middleware('auth');","    Route::post('news/create', 'Admin\\NewsController@create')->middleware('auth');","    Route::get('news', 'Admin\\NewsController@index')->middleware('auth');","    Route::get('news/edit', 'Admin\\NewsController@edit')->middleware('auth');","    Route::post('news/edit', 'Admin\\NewsController@update')->middleware('auth');","    Route::get('news/delete', 'Admin\\NewsController@delete')->middleware('auth');","});","削除機能は画面を持たず、id で指定されたModelをすぐに削除します。","","Controllerの最後で一覧画面にリダイレクトしているため、削除機能は画面を持っていません。","","そのため、Viewテンプレートは不要です。","","ブラウザでアクセスして、削除機能の動作を確認してみましょう。","","課題","【応用】 ProfileControllerを編集して、admin/profile/createから送信されてきたフォーム情報をデータベースに保存するようにしましょう (ヒント: NewsController 参照)","【応用】　1. までできたら、実際に /admin/profile/create からフォームを送信して保存してみましょう","【応用】 resources/views/admin/news/edit.blade.phpを参考にして、プロフィール編集画面用 に、resources/views/admin/profile/edit.blade.php ファイルを作成してください このファイルでは layouts/profile.blade.phpファイルを読み込み、またプロフィールのページであることがわかるように titleとcontentを編集しましょう。 さらに、氏名(name)、性別(gender)、趣味(hobby)、自己紹介欄(introduction)を入力するフォームを作成してください また、formの送信先(<form action=” この部分”>)を、 Admin¥ProfileController の update Action に指定してください。","【応用】 3. ができたら、/admin/profile/edit?id=1 にアクセスしてみましょ。","　※「id=1」の「1」にあたる部分は「編集したいid」を表しており、好きな数字を入力することが可能です","　ただし、テーブルに存在しないidを入力した場合エラーが発生します","","※作成したソースコードをGitHubにプッシュしたうえ、","　該当リポジトリのURLを課題一覧機能より提出してください","","課題提出はこちらから(クリックすると提出画面に飛びます)","","このテキストは理解できましたか？理解したら以下のボタンを押して進捗を登録しましょう。","","","前のページ","カリキュラム一覧へ戻る","次のページ","目次","","データの更新","Controller を実装","View を実装する","データの削除","Controller を実装する","Routingを実装する",""],"id":7}],[{"start":{"row":30,"column":0},"end":{"row":213,"column":0},"action":"remove","lines":["編集画面に実際にブラウザでアクセスしてみましょう。","","一覧画面にある表の一番右側に、編集リンクがあります。このリンクから編集画面に遷移し、実際にデータが編集できるか試してみましょう。","","","","データの削除","データの削除は、データの更新と同じくModelを取り出してから削除を指示します。","","Controller を実装する","NewsControllerに delete Actionを追加してください。","","<?php","","namespace App\\Http\\Controllers\\Admin;","","use Illuminate\\Http\\Request;","use App\\Http\\Controllers\\Controller;","","use App\\News;","","","class NewsController extends Controller","{","  public function add()","  {","      return view('admin.news.create');","  }","","  public function create(Request $request)","  {","","      // Varidationを行う","      $this->validate($request, News::$rules);","","      $news = new News;","      $form = $request->all();","","      // formに画像があれば、保存する","      if (isset($form['image'])) {","        $path = $request->file('image')->store('public/image');","        $news->image_path = basename($path);","      } else {","          $news->image_path = null;","      }","","      unset($form['_token']);","      unset($form['image']);","      // データベースに保存する","      $news->fill($form);","      $news->save();","","      return redirect('admin/news/create');","  }","","  public function index(Request $request)","  {","      $cond_title = $request->cond_title;","      if ($cond_title != '') {","          $posts = News::where('title', $cond_title)->get();","      } else {","          $posts = News::all();","      }","      return view('admin.news.index', ['posts' => $posts, 'cond_title' => $cond_title]);","  }","","","  public function edit(Request $request)","  {","      // News Modelからデータを取得する","      $news = News::find($request->id);","","      return view('admin.news.edit', ['news_form' => $news]);","  }","","","  public function update(Request $request)","  {","      // Validationをかける","      $this->validate($request, News::$rules);","      // News Modelからデータを取得する","      $news = News::find($request->id);","      // 送信されてきたフォームデータを格納する","      $news_form = $request->all();","      unset($news_form['_token']);","","      // 該当するデータを上書きして保存する","      $news->fill($news_form)->save();","","      return redirect('admin/news/');","  }","","  // 以下を追記　　","  public function delete(Request $request)","  {","      // 該当するNews Modelを取得","      $news = News::find($request->id);","      // 削除する","      $news->delete();","      return redirect('admin/news/');","  }  ","","","}","次はデータの削除について考えていきます。","","一般的に削除に対応するAction名はdeleteになります。","","public function delete(Request $request)","  {","      // 該当するNews Modelを取得","      $news = News::find($request->id);","      // 削除する","      $news->delete();","      return redirect('admin/news/');","  }","データをセーブするときは、$news->save();でsaveメソッドを利用しましたが、データの場合はdelete()メソッドを使います。","","また、 resources/views/admin/news/index.blade.php を削除リンクを表示するように修正します。","","                        <tbody>","                            @foreach($posts as $news)","                                <tr>","                                    <th>{{ $news->id }}</th>","                                    <td>{{ str_limit($news->title, 100) }}</td>","                                    <td>{{ str_limit($news->body, 250) }}</td>","                                    <td>","                                        <div>","                                            <a href=\"{{ action('Admin\\NewsController@edit', ['id' => $news->id]) }}\">編集</a>","                                        </div>","                                        <div>","                                            <a href=\"{{ action('Admin\\NewsController@delete', ['id' => $news->id]) }}\">削除</a>","                                        </div>","                                    </td>","                                </tr>","                            @endforeach","                        </tbody>","Routingを実装する","routes/web.php に追加するRouting設定です。","","Route::group(['prefix' => 'admin'], function() {","    Route::get('news/create', 'Admin\\NewsController@add')->middleware('auth');","    Route::post('news/create', 'Admin\\NewsController@create')->middleware('auth');","    Route::get('news', 'Admin\\NewsController@index')->middleware('auth');","    Route::get('news/edit', 'Admin\\NewsController@edit')->middleware('auth');","    Route::post('news/edit', 'Admin\\NewsController@update')->middleware('auth');","    Route::get('news/delete', 'Admin\\NewsController@delete')->middleware('auth');","});","削除機能は画面を持たず、id で指定されたModelをすぐに削除します。","","Controllerの最後で一覧画面にリダイレクトしているため、削除機能は画面を持っていません。","","そのため、Viewテンプレートは不要です。","","ブラウザでアクセスして、削除機能の動作を確認してみましょう。","","課題","【応用】 ProfileControllerを編集して、admin/profile/createから送信されてきたフォーム情報をデータベースに保存するようにしましょう (ヒント: NewsController 参照)","【応用】　1. までできたら、実際に /admin/profile/create からフォームを送信して保存してみましょう","【応用】 resources/views/admin/news/edit.blade.phpを参考にして、プロフィール編集画面用 に、resources/views/admin/profile/edit.blade.php ファイルを作成してください このファイルでは layouts/profile.blade.phpファイルを読み込み、またプロフィールのページであることがわかるように titleとcontentを編集しましょう。 さらに、氏名(name)、性別(gender)、趣味(hobby)、自己紹介欄(introduction)を入力するフォームを作成してください また、formの送信先(<form action=” この���������分”>)を、 Admin¥ProfileController の update Action に指定してください。","【応用】 3. ができたら、/admin/profile/edit?id=1 にアクセスしてみましょ。","　※「id=1」の「1」にあたる部分は「編集したいid」を表しており、好きな数字を入力することが可能です","　ただし、テーブルに存在しないidを入力した場合エラーが発生します","","※作成したソースコードをGitHubにプッシュしたうえ、","　該当リポジトリのURLを課題一覧機能より提出してください","","課題提出はこちらから(クリックすると提出画面に飛びます)","","このテキストは理解できましたか？理解したら以下のボタンを押して進捗を登録しましょう。","","","前のページ","カリキュラム一覧へ戻る","次のページ","目次","","データの更新","Controller を実装","View を実装する","データの削除","Controller を実装する","Routingを実装する",""],"id":7}],[{"start":{"row":26,"column":82},"end":{"row":26,"column":83},"action":"remove","lines":["記"],"id":9},{"start":{"row":26,"column":81},"end":{"row":26,"column":82},"action":"remove","lines":["追"]},{"start":{"row":26,"column":80},"end":{"row":26,"column":81},"action":"remove","lines":[" "]},{"start":{"row":26,"column":79},"end":{"row":26,"column":80},"action":"remove","lines":["/"]}],[{"start":{"row":26,"column":78},"end":{"row":26,"column":79},"action":"remove","lines":["/"],"id":10}],[{"start":{"row":27,"column":85},"end":{"row":27,"column":86},"action":"remove","lines":["記"],"id":11},{"start":{"row":27,"column":84},"end":{"row":27,"column":85},"action":"remove","lines":["追"]},{"start":{"row":27,"column":83},"end":{"row":27,"column":84},"action":"remove","lines":[" "]},{"start":{"row":27,"column":82},"end":{"row":27,"column":83},"action":"remove","lines":["/"]},{"start":{"row":27,"column":81},"end":{"row":27,"column":82},"action":"remove","lines":["/"]}],[{"start":{"row":28,"column":0},"end":{"row":28,"column":1},"action":"insert","lines":["　"],"id":12},{"start":{"row":28,"column":1},"end":{"row":28,"column":2},"action":"insert","lines":["　"]}],[{"start":{"row":28,"column":2},"end":{"row":28,"column":53},"action":"insert","lines":["'Admin\\NewsController@delete')->middleware('auth');"],"id":13}],[{"start":{"row":28,"column":2},"end":{"row":28,"column":29},"action":"insert","lines":[" Route::get('news/delete', "],"id":14}],[{"start":{"row":28,"column":29},"end":{"row":28,"column":30},"action":"insert","lines":[" "],"id":15}],[{"start":{"row":28,"column":29},"end":{"row":28,"column":30},"action":"remove","lines":[" "],"id":16}],[{"start":{"row":28,"column":2},"end":{"row":28,"column":3},"action":"remove","lines":[" "],"id":17}],[{"start":{"row":28,"column":2},"end":{"row":28,"column":79},"action":"remove","lines":["Route::get('news/delete', 'Admin\\NewsController@delete')->middleware('auth');"],"id":18}],[{"start":{"row":28,"column":2},"end":{"row":28,"column":81},"action":"insert","lines":["  Route::get('news/delete', 'Admin\\NewsController@delete')->middleware('auth');"],"id":19}],[{"start":{"row":28,"column":80},"end":{"row":28,"column":81},"action":"remove","lines":[";"],"id":20},{"start":{"row":28,"column":79},"end":{"row":28,"column":80},"action":"remove","lines":[")"]}],[{"start":{"row":28,"column":2},"end":{"row":28,"column":3},"action":"remove","lines":[" "],"id":21},{"start":{"row":28,"column":1},"end":{"row":28,"column":2},"action":"remove","lines":["　"]}],[{"start":{"row":28,"column":1},"end":{"row":28,"column":2},"action":"insert","lines":["　"],"id":22}],[{"start":{"row":28,"column":2},"end":{"row":28,"column":6},"action":"insert","lines":["    "],"id":23}],[{"start":{"row":28,"column":5},"end":{"row":28,"column":6},"action":"remove","lines":[" "],"id":24},{"start":{"row":28,"column":4},"end":{"row":28,"column":5},"action":"remove","lines":[" "]}],[{"start":{"row":28,"column":4},"end":{"row":28,"column":6},"action":"insert","lines":["  "],"id":25}],[{"start":{"row":28,"column":5},"end":{"row":28,"column":6},"action":"remove","lines":[" "],"id":26},{"start":{"row":28,"column":4},"end":{"row":28,"column":5},"action":"remove","lines":[" "]},{"start":{"row":28,"column":3},"end":{"row":28,"column":4},"action":"remove","lines":[" "]},{"start":{"row":28,"column":2},"end":{"row":28,"column":3},"action":"remove","lines":[" "]},{"start":{"row":28,"column":1},"end":{"row":28,"column":2},"action":"remove","lines":["　"]}],[{"start":{"row":28,"column":1},"end":{"row":28,"column":3},"action":"insert","lines":["  "],"id":27}],[{"start":{"row":28,"column":2},"end":{"row":28,"column":3},"action":"remove","lines":[" "],"id":28},{"start":{"row":28,"column":1},"end":{"row":28,"column":2},"action":"remove","lines":[" "]},{"start":{"row":28,"column":0},"end":{"row":28,"column":1},"action":"remove","lines":["　"]}],[{"start":{"row":28,"column":0},"end":{"row":28,"column":4},"action":"insert","lines":["    "],"id":29}],[{"start":{"row":28,"column":5},"end":{"row":28,"column":80},"action":"remove","lines":["Route::get('news/delete', 'Admin\\NewsController@delete')->middleware('auth'"],"id":30}],[{"start":{"row":28,"column":3},"end":{"row":28,"column":82},"action":"insert","lines":["  Route::get('news/delete', 'Admin\\NewsController@delete')->middleware('auth');"],"id":31}],[{"start":{"row":29,"column":0},"end":{"row":31,"column":0},"action":"insert","lines":["","    ",""],"id":32}],[{"start":{"row":29,"column":0},"end":{"row":29,"column":1},"action":"insert","lines":[" "],"id":33},{"start":{"row":29,"column":1},"end":{"row":29,"column":2},"action":"insert","lines":[" "]},{"start":{"row":29,"column":2},"end":{"row":29,"column":3},"action":"insert","lines":[" "]},{"start":{"row":29,"column":3},"end":{"row":29,"column":4},"action":"insert","lines":[" "]}],[{"start":{"row":29,"column":4},"end":{"row":29,"column":84},"action":"insert","lines":["Route::get('profile/create', 'Admin\\ProfileController@add')->middleware('auth');"],"id":34}]]},"ace":{"folds":[],"scrolltop":93.78939067972513,"scrollleft":0,"selection":{"start":{"row":29,"column":22},"end":{"row":29,"column":22},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1630474769894,"hash":"2c2c79011bf7d663a6b09e273fe0b084e3e789ba"}